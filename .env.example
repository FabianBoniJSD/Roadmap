# =============================================================================
# Next.js Roadmap - Environment Configuration Example
# =============================================================================
# Copy this file to .env.local for development or .env.production for production
# NEVER commit .env.local or .env.production to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Deployment Environment
# -----------------------------------------------------------------------------
# Controls which SharePoint site URL and basePath to use
# Options: 'development' | 'production'
NEXT_PUBLIC_DEPLOYMENT_ENV=development
NODE_ENV=development

# -----------------------------------------------------------------------------
# SharePoint Site URLs
# -----------------------------------------------------------------------------
# Development SharePoint site URL (used when NEXT_PUBLIC_DEPLOYMENT_ENV=development)
NEXT_PUBLIC_SHAREPOINT_SITE_URL_DEV=https://your-sharepoint-dev.domain.com/sites/yoursite

# Production SharePoint site URL (used when NEXT_PUBLIC_DEPLOYMENT_ENV=production)
NEXT_PUBLIC_SHAREPOINT_SITE_URL_PROD=https://your-sharepoint-prod.domain.com/sites/yoursite

# -----------------------------------------------------------------------------
# Application Base Path
# -----------------------------------------------------------------------------
# Base path for the application when hosted in a subdirectory
# Leave empty if hosted at root, otherwise use format: /your-path (no trailing slash)
NEXT_PUBLIC_BASE_PATH_DEV=
NEXT_PUBLIC_BASE_PATH_PROD=/roadmap

# -----------------------------------------------------------------------------
# Internal API Configuration
# -----------------------------------------------------------------------------
# Base URL for server-side API calls (used in SSR contexts)
# Format: http://localhost:3000 or https://your-domain.com
INTERNAL_API_BASE_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# Database / Multi-Instance Configuration
# -----------------------------------------------------------------------------
# Prisma connection string (SQLite by default)
DATABASE_URL="file:./prisma/dev.db"

# Default roadmap instance slug. Used when no host/header/cookie override is set.
DEFAULT_ROADMAP_INSTANCE=bdm-projekte
DEFAULT_ROADMAP_HOSTS=roadmap.bs.ch,roadmap-admin.bs.ch
NEXT_PUBLIC_DEFAULT_INSTANCE=bdm-projekte
# Optional: provide JSON definitions for multiple instances (see prisma/seed.instances.json)
# ROADMAP_SEED_INSTANCES=[{"slug":"bdm-projekte","sharePointSiteUrlDev":"https://spi.intranet.bs.ch/bdm/Projekte"}]

# -----------------------------------------------------------------------------
# SharePoint Authentication Strategy
# -----------------------------------------------------------------------------
# Authentication method for SharePoint access
# Options: 'online' | 'onprem' | 'kerberos' | 'fba' | 'basic'
# - online: SharePoint Online (Microsoft 365)
# - onprem: On-premises SharePoint with NTLM
# - kerberos: Windows Authentication with Kerberos/SPNEGO
# - fba: Forms-Based Authentication
# - basic: Basic HTTP Authentication
SP_STRATEGY=onprem
NEXT_PUBLIC_SP_AUTH_MODE=onprem

# -----------------------------------------------------------------------------
# SharePoint Credentials - GitHub Secrets Integration (Recommended)
# -----------------------------------------------------------------------------
# ⚠️ SECURITY WARNING: These credentials grant full access to SharePoint
#
# ⚠️ NEW: Multi-User GitHub Secrets (Recommended for Production)
# Format: USER_<name> with value "<username>:<password>"
# Example GitHub Secrets:
#   USER_FABIAN: "fabian:password123"        # Klartext → wird automatisch in Bcrypt gehasht
#   USER_STEFAN: "stefan:$2b$12$abcdefghijklmnopqrstuv"  # Bereits gehashte Variante
#   USER_ADMIN:  "admin:admin789"
#
# Benefits:
# ✅ All USER_* automatically have admin rights (no SharePoint permission check needed)
# ✅ Multiple users can be configured
# ✅ Easy to rotate individual user credentials
# ✅ First available user is automatically selected
#
# For GitHub Actions: Set as Repository Secrets
# For local development: Set as environment variables
#   $env:USER_FABIAN="fabian:password"  (PowerShell)
#   export USER_FABIAN="fabian:password" (Bash)
#   # Optional bereits gehasht:
#   export USER_STEFAN="stefan:$2b$12$abcdefghijklmnopqrstuv"

# Fallback: Traditional Single Service Account (Legacy)
# Only used if no USER_* secrets are found
# The service account must have Site Collection Admin or Owners Group permissions.
SP_USERNAME=
SP_PASSWORD=

# Domain for on-premises SharePoint (optional, extracted from username if included)
SP_ONPREM_DOMAIN=

# Workstation name for NTLM authentication (optional, defaults to hostname)
SP_ONPREM_WORKSTATION=

# -----------------------------------------------------------------------------
# SharePoint Authentication Options (Advanced)
# -----------------------------------------------------------------------------
# Additional authentication modes to try if primary fails (comma-separated)
SP_AUTH_EXTRA=

# Force single credential set (disable automatic permutation)
SP_FORCE_SINGLE_CREDS=false

# Disable authentication caching (useful for debugging)
SP_AUTH_NO_CACHE=false

# Enable manual NTLM fallback for legacy servers
SP_MANUAL_NTLM_FALLBACK=false

# Enable persistent socket for NTLM (performance optimization)
SP_NTLM_PERSISTENT_SOCKET=false

# Enable NTLM socket probing for diagnostics
SP_NTLM_SOCKET_PROBE=false

# Enable NTLM diagnostic logging
SP_NTLM_DIAG=false

# -----------------------------------------------------------------------------
# Forms-Based Authentication (FBA) Configuration
# -----------------------------------------------------------------------------
# Path to FBA login page (only needed if SP_STRATEGY=fba)
SP_FBA_LOGIN_PATH=/_layouts/15/Authenticate.aspx

# -----------------------------------------------------------------------------
# TLS/SSL Configuration
# -----------------------------------------------------------------------------
# Allow self-signed certificates (⚠️ DEVELOPMENT ONLY - Never use in production!)
SP_ALLOW_SELF_SIGNED=false

# Path to custom trusted CA certificate file
# Use absolute path or relative to project root
SP_TRUSTED_CA_PATH=

# -----------------------------------------------------------------------------
# SharePoint Proxy Configuration
# -----------------------------------------------------------------------------
# HTTP/HTTPS proxy for outbound SharePoint requests
# Format: http://proxy-host:port or https://proxy-host:port
# Leave empty if no proxy is needed
# HTTP_PROXY=http://127.0.0.1:3128
# HTTPS_PROXY=http://127.0.0.1:3128

# node-sp-auth proxy workaround
# node-sp-auth v3.x has agent compatibility issues with HTTP_PROXY/HTTPS_PROXY
# By default, proxy is temporarily disabled for node-sp-auth authentication calls
# Set to 'true' ONLY if SharePoint server is accessible ONLY through proxy
# (This may cause authentication errors due to got library agent issues)
SP_NODE_SP_AUTH_NEEDS_PROXY=false

# Enable debug logging for SharePoint proxy
SP_PROXY_DEBUG=false

# Enable pre-flight connectivity check
SP_PRECHECK=false

# Dump root site web data for debugging
SP_DUMP_ROOT=false

# Allow listing all SharePoint lists (debugging only)
# ⚠️ Security risk - only enable for troubleshooting
# SP_PROXY_DEBUG=true

# -----------------------------------------------------------------------------
# Application Debug Settings
# -----------------------------------------------------------------------------
# Enable authentication debug mode
NEXT_PUBLIC_DEBUG_AUTH=false

# Expose debug utilities in browser console
NEXT_PUBLIC_DEBUG_EXPOSE=0

# Disable Next.js build configuration logging
SUPPRESS_CONFIG_LOG=0

# Disable Next.js telemetry
NEXT_TELEMETRY_DISABLED=1

# -----------------------------------------------------------------------------
# JWT Token Configuration (for admin authentication)
# -----------------------------------------------------------------------------
# Secret key for signing JWT tokens
# ⚠️ Generate a strong random string (minimum 32 characters)
# Example: openssl rand -base64 32
JWT_SECRET=your-secure-random-string-here-minimum-32-characters

# Token expiration time (default: 24 hours)
JWT_EXPIRES_IN=24h

# -----------------------------------------------------------------------------
# Microsoft Entra ID (Azure AD) SSO (optional)
# -----------------------------------------------------------------------------
# Enables admin login via Microsoft SSO (OIDC Authorization Code flow).
# Create an App Registration and configure a Web redirect URI pointing to:
#   https://<your-host><basePath>/api/auth/entra/callback
# Example (with basePath=/roadmap):
#   https://roadmap.example.com/roadmap/api/auth/entra/callback

# Tenant ID (GUID) or 'common' (GUID recommended)
ENTRA_TENANT_ID=

# Application (client) ID
ENTRA_CLIENT_ID=

# Client secret (for the confidential web client)
ENTRA_CLIENT_SECRET=

# Optional: hard override for redirect URI (recommended when behind reverse proxies)
# If unset, the app derives it from NEXT_PUBLIC_BASE_PATH_* and request headers.
ENTRA_REDIRECT_URI=

# Admin access control:
# - safest default: require explicit allowlist via UPN/email
# - comma-separated list, case-insensitive
ENTRA_ADMIN_UPNS=

# Development escape hatch (NOT recommended): allow any Entra user as admin
ENTRA_ALLOW_ALL=false

# -----------------------------------------------------------------------------
# Production Deployment (GitHub Actions / PM2)
# -----------------------------------------------------------------------------
# These are typically set in the deployment environment, not in .env files

# Port for the application (default: 3000)
# PORT=3000

# PM2 process name
# PM2_APP_NAME=roadmap-app

# =============================================================================
# Security Notes
# =============================================================================
# 1. NEVER commit .env.local or .env.production to Git
# 2. For production, use encrypted environment variable management:
#    - dotenv-vault (recommended)
#    - Azure Key Vault
#    - AWS Secrets Manager
#    - HashiCorp Vault
# 3. Rotate credentials regularly
# 4. Use service accounts with minimum required permissions
# 5. Enable audit logging in SharePoint for service account activity
# 6. Consider using Managed Identity or certificate-based auth for production
# =============================================================================
